var page=1;var display_number=10;var tag_id=0;var time_before="";var time_after="";var label="";var title="";var summary="";var content="";var author="";$(function(){$(document).ready(function(){$("#section_body").css("min-height",$(window).height());if(isMobile()){$("#display_number").css({position:"relative",left:"36%",width:"28%"})}if(Request["p"]!=undefined){if(Request["p"]<1||isNaN(Request["p"])){}else{page=Request["p"]}}if(Request["n"]!=undefined){if(Request["n"]<1||isNaN(Request["n"])){}else{display_number=Request["n"]}}if(Request["tag"]!=undefined){if(Request["tag"]<1||isNaN(Request["tag"])){}else{tag_id=Request["tag"]}}if(Request["keywords"]!=undefined){$("#keywords").val(Request["keywords"]);keywords_array=Request["keywords"].split(/\s+/);keywords_array_map=keywords_array.map(addSpecialChar);set_all_keys(keywords_array_map)}search_blogs()})});function search_blogs(){$.ajax({url:"php/ajax.php",type:"POST",data:{func:"search_article_list",page:page,display_number:display_number,tag_id:tag_id,time_before:"",time_after:"",label:label,title:title,summary:summary,content:content,author:author},dataType:"json",success:function(e){if(e.status==0){$("#current_page").html(page);$("#total_pages").html(e.total_pages);var a=$("#change_page");a.html("");for(var t=1;t<=e.total_pages;t++){$("<option value="+t+">"+t+"</option>").appendTo(a)}a.children().eq(page-1).attr("selected",true);if(page>=e.total_pages){$("#next_page").addClass("hide")}else{$("#next_page").removeClass("hide")}show_blogs(e.blogs)}else{toastr.warning(e.error)}},error:function(e){toastr.error("HTTP状态码："+e.status)}})}function show_blogs(e){var a=$("#div_show_blogs");a.html("");if(e==null){$('<p class="text-center" style="font-size:2em">抱歉，搜索不到内容，请换个姿势搜索～</p><p>&nbsp;</p>').appendTo(a);$("#form_display_number").addClass("hide");$("#form_show_page").addClass("hide")}else{var t=e.length;for(var s=0;s<t;s++){var r=$("<article id="+e[s].article_id+' class="post"></article>');r.appendTo(a);var i=$('<div class="post-head"></div>');i.appendTo(r);$('<h1 class="post-title"><a href="./blog/'+e[s].article_id+'/">'+e[s].title+"</a></h1>").appendTo(i);var l=$('<div class="post-meta"></div>');l.appendTo(i);$('<span class="author">作者：<a href="javascript:void(0);">'+e[s].author+"</a></span> &bull;").appendTo(l);$('<time class="post-date" datetime="" title="">'+e[s].published_time+"</time>").appendTo(l);if(e[s].cover!=null){var o=$('<div class="featured-media"></div>');o.appendTo(r);$('<a href="./blog/'+e[s].article_id+'/"><img src="'+e[s].cover+'" alt="'+e[s].title+'" onerror="this.src=\'Public/img/error.jpg\'"></a>').appendTo(o)}if(e[s].summary!=null){var n=$('<div class="post-content"></div>');n.appendTo(r);$("<p>"+e[s].summary+"</p>").appendTo(n)}$('<div class="post-permalink"><a href="./blog/'+e[s].article_id+'/" class="btn btn-default">阅读全文</a></div>').appendTo(r);var p=$('<footer class="post-footer clearfix"></footer>');p.appendTo(r);var d=$('<div class="pull-left tag-list"></div>');d.appendTo(p);$('<i class="fa fa-folder-open-o"></i>').appendTo(d);if(e[s].tags!=null){var u=e[s].tags;var c=u.length;for(var _=0;_<c;_++){$('<a href="./search.html?tag='+u[_].tag_id+'">'+u[_].label+"</a>&nbsp;").appendTo(d)}}}$("#form_display_number").removeClass("hide");$("#form_show_page").removeClass("hide")}}$("#submit_display_number").click(function(e){e.preventDefault();var a=$("#display_number").val();if(a<1||isNaN(a)||!isInteger(a)){toastr.warning("请输入大于1的整数");$("#display_number").focus();return}display_number=a;page=1;search_blogs()});$("#next_page").click(function(){page=parseInt(page)+1;search_blogs()});$("#change_page").change(function(){page=$("#change_page").val();search_blogs()});$("#submit_keywords").click(function(e){e.preventDefault();var a=$("#keywords").val();keywords_array=a.split(/\s+/);keywords_array_map=keywords_array.map(addSpecialChar);set_all_keys(keywords_array_map);search_blogs()});function isInteger(e){return e%1===0}function init_all_attr(){tag_id=0;time_before="";time_after="";label="";title="";summary="";content="";author=""}function set_all_keys(e){label=e;title=e;summary=e;content=e;author=e}function addSpecialChar(e){return"%"+e+"%"}