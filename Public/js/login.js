var current_host=window.location.host;$(function(){$(document).ready(function(){var e=window.location.search;var t=e.indexOf("_from=");if(t!=-1){source_address=e.substr(t+6);source_address=source_address.replace(/\&/,"?")}$.ajax({url:"php/ajax.php",type:"POST",dataType:"json",data:{func:"is_login",userAgent:navigator.userAgent},success:function(e){if(e.status==0){location.href="//"+current_host+source_address}else{if(Request["_to"]=="login"){$("#login_form").removeClass("hide")}else{$("#register_form").removeClass("hide")}}},error:function(e){toastr.error("HTTP状态码："+e.status)}})})});$("#display_reg").on("click",function(e){e.preventDefault();$("#reg_id").val("");$("#inputEmail").val("");$("#reg_password").val("");$("#con_reg_password").val("");$("#login_id").val(".");$("#login_password").val(".");$("#login_form").addClass("hide");$("#register_form").removeClass("hide")});$("#display_sig").on("click",function(e){e.preventDefault();$("#reg_id").val(".");$("#inputEmail").val("1@a");$("#reg_password").val(".");$("#con_reg_password").val(".");$("#login_id").val("");$("#login_password").val("");$("#login_form").removeClass("hide");$("#register_form").addClass("hide")});$("#signin").on("click",function(e){e.preventDefault();var t=$.trim($("#login_id").val());var r=$.trim($("#login_password").val());if(t==""){$("#login_id").focus();toastr.warning("请填写您的用户名或邮箱");return}if(r==""){$("#login_password").focus();toastr.warning("请填写密码");return}r=r.MD5(32);var a=/^[0-9a-zA-Z_-]{1,100}$/;var s=navigator.userAgent;$(".form-signin").eq(0).addClass("hide");$.ajax({url:"php/ajax.php",type:"POST",data:{func:"login",username:t,is_email:a.test(t)?false:true,password:r,userAgent:s},dataType:"json",success:function(e){if(e.status==0){location.href="//"+current_host+source_address}else{$(".form-signin").eq(0).removeClass("hide");toastr.warning(e.error)}},error:function(e){$(".form-signin").eq(0).removeClass("hide");toastr.error("HTTP状态码："+e.status)}})});$("#register").on("click",function(e){e.preventDefault();$(this).attr("disabled",true);var t=$.trim($("#reg_id").val());var r=$.trim($("#inputEmail").val());var a=$("#reg_password").val();var s=$("#con_reg_password").val();var i=$("#sex").val();var n=$.trim($("#CaptchaCode").val());var o=/^[0-9a-zA-Z_-]{1,100}$/;var l=/^([\w-_]+(?:\.[\w-_]+)*)@((?:[a-z0-9]+(?:-[a-zA-Z0-9]+)*)+\.[a-z]{2,6})$/i;if(!o.test(t)){$(this).attr("disabled",false);$("#reg_id").focus();toastr.warning('请正确填写您的用户名，长度不能超过100，且只能使用数字、字母或"_"、"-"');return}if(r.length>100){$(this).attr("disabled",false);$("#inputEmail").focus();toastr.warning("邮箱地址长度不能超过100位，请联系管理员");return}if(r==""||!l.test(r)){$(this).attr("disabled",false);$("#inputEmail").focus();toastr.warning("请正确填写您的邮箱地址");return}if(a.length<6||a.length>20){$(this).attr("disabled",false);$("#reg_password").focus();toastr.warning("密码长度须为6至20位");return}if(s!=a){$(this).attr("disabled",false);$("#con_reg_password").focus();toastr.warning("密码不一致，请认真校对");return}if(n==""){$(this).attr("disabled",false);$("#CaptchaCode").focus();toastr.warning("请填写验证码");return}a=a.MD5(32);$.ajax({url:"php/ajax.php",type:"POST",data:{func:"register",username:t,email:r,password:a,sex:i,CaptchaCode:n},dataType:"json",success:function(e){$("#register").attr("disabled",false);if(e.status==0){$("#register_form").html("");$('<h3 class="text-center">请前往邮箱激活账号<br/>没收到的话请检查垃圾箱<br/><span id="time_clock" style="color:blue"></span><span id="time_text"></span><a href="javascript:void(0)" value='+e.id+' id="resend" onclick="resend()">重新发送</a></h3>').appendTo($("#register_form"));resend();toastr.success("注册成功")}else if(e.status==-2){$("#CaptchaCode").focus();$("#CaptchaCode").val("");$("#captcha_img").trigger("click");toastr.warning("验证码过期，请重新填写")}else if(e.status==-3){$("#CaptchaCode").focus();$("#CaptchaCode").val("");$("#captcha_img").trigger("click");toastr.warning(e.error)}else{toastr.warning(e.error)}},error:function(e){$("#register").attr("disabled",false);toastr.error("HTTP状态码："+e.status)}})});function resend(){$("#time_text").html("秒后可重新发送");$("#time_clock").html("60");$("#resend").html("");i=60;var e=setInterval(function(){i--;$("#time_clock").html(i)},1e3);var t=setTimeout(function(){$("#time_text").html("");$("#time_clock").html("");$("#resend").html("重新发送");clearInterval(e);clearTimeout(t)},6e4);$.ajax({url:"php/ajax.php",type:"POST",data:{func:"resend_email",id:$("#resend").attr("value"),path:path},dataType:"json",success:function(r){if(r.status==0){}else if(r.status==-100){$("#time_text").html("");$("#time_clock").html("");$("#resend").html("即将前往主页");clearInterval(e);clearTimeout(t);toastr.warning("邮箱已被激活，即将跳转到主页").click(function(){location.href="./index.html"});setTimeout(function(){location.href="./index.html"},3e3)}else{$("#time_text").html("");$("#time_clock").html("");$("#resend").html("重新发送");clearInterval(e);clearTimeout(t);toastr.warning(r.error)}},error:function(e){toastr.error("HTTP状态码："+e.status)}})}